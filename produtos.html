<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Produtos - AsaDelta Esportes</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- ✅ Seu CSS agora separado -->
  <link rel="stylesheet" href="produtos.css">
</head>

<body>
  <!-- ✅ NAVBAR IDÊNTICA -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <i class="bi bi-trophy-fill me-2"></i>AsaDelta Esportes
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="clientes.html">Clientes</a></li>
                    <li class="nav-item"><a class="nav-link" href="quadras.html">Quadras</a></li>
                    <li class="nav-item"><a class="nav-link" href="produtos.html">Produtos</a></li>
                    <li class="nav-item"><a class="nav-link" href="reservas.html">Reservas PC</a></li>
                    <li class="nav-item"><a class="nav-link" href="reservasMobile.html">Reservas Mobile</a></li>
                    <li class="nav-item"><a class="nav-link" href="comandas.html">Comandas</a></li>
                    <li class="nav-item"><a class="nav-link" href="relatorios.html">Relatórios</a></li>
                    <li class="nav-item"><a class="nav-link" href="relatorioReservas.html">Rel. Reservas</a></li>
                </ul>
      </div>
    </div>
  </nav>

  <main class="container-fluid px-3 px-lg-4 py-4">
    <div class="row g-3">
      <div class="col-12">
        <div class="card card-custom p-3 p-lg-4">

          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
            <div>
              <div class="h5 mb-0 fw-bold-custom">Cadastro & Controle</div>
              <div class="small-note">Produtos, estoque, custo, venda e médias.</div>
            </div>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-outline-dark btn-sm fw-bold" onclick="abrirModalRelatorios()">
                <i class="bi bi-archive"></i> Relatórios
              </button>
              <button class="btn btn-outline-primary btn-sm fw-bold" onclick="abrirModalCompra()">
                <i class="bi bi-cart-plus"></i> Compra
              </button>
              <button class="btn btn-outline-success btn-sm fw-bold" onclick="abrirModalConferencia()">
                <i class="bi bi-clipboard-check"></i> Conferência de estoque
              </button>
              <button class="btn btn-outline-warning btn-sm fw-bold" onclick="gerarRelatorioCompras()">
                <i class="bi bi-bag-check"></i> Rel. Compras
              </button>
            </div>
          </div>

          <!-- FORM PRODUTO -->
          <div class="row g-2 align-items-end">
            <input type="hidden" id="idProduto" />

            <div class="col-md-3">
              <label class="form-label">Produto</label>
              <input type="text" class="form-control" id="nome" placeholder="Ex.: Cerveja" />
            </div>

            <div class="col-md-2">
              <label class="form-label">Fornecedor</label>
              <input type="text" class="form-control" id="fornecedor" placeholder="Ex.: Ambev" />
            </div>

            <div class="col-md-2">
              <label class="form-label">Estoque</label>
              <input type="number" class="form-control" id="estoque" step="1" min="0" value="0" />
            </div>

            <div class="col-md-2">
              <label class="form-label">Mínimo</label>
              <input type="number" class="form-control" id="estoque_minimo" step="1" min="0" value="0" />
            </div>

            <div class="col-md-1">
              <label class="form-label">Custo</label>
              <input type="number" class="form-control" id="preco_custo" step="0.01" min="0" value="0" />
            </div>

            <div class="col-md-1">
              <label class="form-label text-success fw-bold">Venda</label>
              <input type="number" class="form-control" id="preco_venda" step="0.01" min="0" value="0" />
            </div>

            <div class="col-md-1 d-grid">
              <button class="btn btn-success-custom" onclick="salvarProduto()"><i class="bi bi-save"></i> Salvar</button>
            </div>

            <div class="col-md-1 d-grid">
              <button class="btn btn-outline-secondary" onclick="limpar()"><i class="bi bi-x-lg"></i></button>
            </div>
          </div>

          <!-- ✅ Linha extra (código de barras + tipo) mantendo Bootstrap -->
          <div class="row g-2 mt-2 align-items-end">
            <div class="col-md-6">
              <label class="form-label">Código de barras</label>
              <input type="text" class="form-control" id="codigo_barras" placeholder="Opcional" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Tipo</label>
              <select class="form-select" id="tipo" onchange="onTipoChange()">
                <option value="normal">Normal</option>
                <option value="combo">Combo</option>
              </select>
            </div>
            <div class="col-md-3">
              <div class="alert alert-light border small-note mb-0 py-2">
                <b>Combo:</b> selecione itens e quantidades (ex.: 0,5).
              </div>
            </div>
          </div>

          <!-- ✅ Editor de Combo (aparece só quando tipo=combo) -->
          <div id="comboEditor" class="combo-editor mt-3" style="display:none;">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
              <div class="fw-bold-custom"><i class="bi bi-boxes"></i> Itens do Combo</div>
              <div class="d-flex flex-wrap gap-2 align-items-center">
                <button class="btn btn-outline-secondary btn-sm fw-bold" onclick="addItemCombo()">
                  <i class="bi bi-plus-circle"></i> Adicionar item
                </button>
                <span class="badge bg-light text-dark border" id="comboCustoEstimado">Custo estimado: R$ 0,00</span>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-sm table-striped align-middle mb-0">
                <thead>
                  <tr>
                    <th class="text-start">Produto</th>
                    <th style="width:160px;">Quantidade</th>
                    <th style="width:70px;"></th>
                  </tr>
                </thead>
                <tbody id="tbodyCombo"></tbody>
              </table>
            </div>

            <div class="small-note mt-2">
              Ex.: <b>0,5</b> croquete + <b>0,5</b> gouda + <b>1</b> fritas.
            </div>
          </div>

          <hr class="my-4">

          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
            <button class="btn btn-danger btn-sm fw-bold" onclick="resetarMediaGlobal()">
              <i class="bi bi-arrow-counterclockwise"></i> Resetar média de vendas
            </button>

            <span id="diasMediaInfo" class="badge bg-secondary">Dias da média: —</span>

            <div class="input-group" style="max-width:340px;">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input type="text" class="form-control" id="busca" placeholder="Filtrar produtos..." onkeyup="filtrar()">
            </div>
          </div>

          <!-- TABELA PRODUTOS -->
          <div class="table-responsive mt-2">
            <table class="table table-hover align-middle mb-0 text-center">
              <thead>
                <tr>
                  <th class="text-start">Descrição</th>
                  <th>Fornecedor</th>
                  <th>Custo</th>
                  <th>Venda</th>
                  <th>Lucro (un)</th>
                  <th>Estoque</th>
                  <th>Mínimo</th>
                  <th>Vendas Totais</th>
                  <th>Média / dia</th>
                  <th class="text-end">Ações</th>
                </tr>
              </thead>
              <tbody id="tabelaProdutos"></tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </main>

  <!-- MODAIS (iguais ao seu original) -->
  <!-- CONFERÊNCIA -->
  <div class="modal fade" id="modalConferencia" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title fw-bold"><i class="bi bi-clipboard-check"></i> Conferência de estoque</h5>
            <div class="small-note">Preencha apenas os itens que deseja ajustar. Em branco = estoque OK.</div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-light border small-note mb-3">
            • Se você informar <b>0</b>, o produto passa a ter estoque <b>0</b> (sem unidades).<br>
            • Relatório calcula impacto por <b>valor de venda</b>.
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th class="text-start">Produto</th>
                  <th>Fornecedor</th>
                  <th>Venda</th>
                  <th>Estoque atual</th>
                  <th style="width:180px;">Qtd conferida</th>
                </tr>
              </thead>
              <tbody id="tbodyConferencia"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <span class="me-auto small-note" id="conferenciaStatus"></span>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
          <button class="btn btn-success-custom" onclick="confirmarConferencia()">
            <i class="bi bi-check2-circle"></i> Ajustar estoque + Gerar PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- COMPRA -->
  <div class="modal fade" id="modalCompra" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title fw-bold"><i class="bi bi-cart-plus"></i> Compra</h5>
            <div class="small-note">Selecione o fornecedor para lançar compra e recalcular custo médio.</div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2 align-items-end mb-3">
            <div class="col-md-6">
              <label class="form-label">Fornecedor</label>
              <select class="form-select" id="selectFornecedorCompra" onchange="carregarTabelaCompra()"></select>
            </div>
            <div class="col-md-6">
              <div class="alert alert-light border small-note mb-0">
                • Quantidade em branco = não comprou<br>
                • Valor pago em branco = usa o custo já cadastrado
              </div>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th class="text-start">Produto</th>
                  <th>Estoque atual</th>
                  <th>Custo atual</th>
                  <th style="width:140px;">Qtd comprada</th>
                  <th style="width:180px;">Valor pago (un)</th>
                </tr>
              </thead>
              <tbody id="tbodyCompra"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <span class="me-auto small-note" id="compraStatus"></span>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
          <button class="btn btn-success-custom" onclick="confirmarCompra()">
            <i class="bi bi-check2-circle"></i> Salvar compra + Gerar PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- RELATÓRIOS -->
  <div class="modal fade" id="modalRelatorios" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title fw-bold"><i class="bi bi-archive"></i> Relatórios</h5>
            <div class="small-note">Pesquise por período e baixe novamente (PDF gerado na hora).</div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2 align-items-end mb-3">
            <div class="col-md-3">
              <label class="form-label">Data início</label>
              <input type="date" class="form-control" id="relInicio">
            </div>
            <div class="col-md-3">
              <label class="form-label">Data fim</label>
              <input type="date" class="form-control" id="relFim">
            </div>
            <div class="col-md-3">
              <label class="form-label">Tipo</label>
              <select class="form-select" id="relTipo">
                <option value="">Todos</option>
                <option value="conferencia_estoque">Conferência de estoque</option>
                <option value="compra">Compra</option>
                <option value="sugestao_compra">Sugestão de compra</option>
              </select>
            </div>
            <div class="col-md-3 d-grid">
              <button class="btn btn-success-custom" onclick="buscarRelatorios()"><i class="bi bi-search"></i> Buscar</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Tipo</th>
                  <th>Fornecedor</th>
                  <th>Resumo</th>
                  <th class="text-end">Ações</th>
                </tr>
              </thead>
              <tbody id="tbodyRelatorios"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <span class="me-auto small-note" id="relatoriosStatus"></span>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase v8 (mantido) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- ✅ Seu JS agora separado -->
  <script src="produtos.js"></script>
</body>
</html>
